<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Petit bout de Martin üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Anime.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            float: "float 4s ease-in-out infinite",
            pulseSlow: "pulseSlow 3s ease-in-out infinite",
            fadeIn: "fadeIn 0.5s forwards",
            fadeOut: "fadeOut 0.5s forwards",
            heartbeatSlow: "heartbeatSlow 3s ease-in-out infinite",
          },
          keyframes: {
            float: {
              "0%": { transform: "translateY(0)" },
              "50%": { transform: "translateY(-10px)" },
              "100%": { transform: "translateY(0)" },
            },
            pulseSlow: {
              "0%, 100%": { transform: "scale(1)" },
              "50%": { transform: "scale(1.15)" },
            },
            fadeIn: {
              from: { opacity: "0", transform: "translateY(-10px)" },
              to: { opacity: "1", transform: "translateY(0)" },
            },
            fadeOut: {
              from: { opacity: "1", transform: "translateY(0)" },
              to: { opacity: "0", transform: "translateY(-10px)" },
            },
            heartbeatSlow: {
              "0%": { transform: "scale(1)" },
              "25%": { transform: "scale(1.05)" },
              "50%": { transform: "scale(1)" },
              "75%": { transform: "scale(1.05)" },
              "100%": { transform: "scale(1)" },
            }
          },
        },
      },
    };
  </script>
  <style>
    body {
      transition: background 1s ease, color 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    /* D√©grad√©s selon l'heure */
    .morning-bg { background: linear-gradient(120deg, #FFDEE9, #B5FFFC); }
    .afternoon-bg { background: linear-gradient(120deg, #FBD786, #f7797d); }
    .evening-bg { background: linear-gradient(120deg, #a18cd1, #fbc2eb); }
    .night-bg {
      background: linear-gradient(120deg, #0f2027, #203a43, #2c5364);
      color: #d1d5db;
    }
    /* Adaptation du texte et des backgrounds en mode nuit */
    .night-bg #comfort-message,
    .night-bg #daily-message,
    .night-bg #status,
    .night-bg #datetime,
    .night-bg #brain-indicator span {
      color: #d1d5db !important;
    }
    .night-bg #comfort-message,
    .night-bg #daily-message,
    .night-bg #brain-indicator {
      background-color: rgba(0, 0, 0, 0.7) !important;
    }
    /* Fond stylis√© pour le titre et la bo√Æte */
    .title-bg {
      background: linear-gradient(90deg, #fbc2eb, #a6c1ee);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    /* Conteneur de pluie d'√©toiles */
    #star-rain {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
      display: none; /* S'affiche uniquement si heure >= 21 */
    }
    /* Les √©toiles seront cr√©√©es dynamiquement en tant que spans avec l'emoji "‚ú®" */
    .star {
      position: absolute;
      opacity: 0;
      top: 0%; /* Apparition d√®s le haut */
    }
    /* Style pour la bo√Æte indice "pssst" */
    #hint-text {
      background: rgba(255, 255, 255, 0.8);
      padding: 4px 8px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      white-space: normal;
      text-align: center;
      /* Pour s'assurer que le texte s'adapte sur mobile */
      width: 100%;
      max-width: 300px;
    }
  </style>
</head>
<body class="flex flex-col justify-center items-center min-h-screen relative overflow-hidden p-4">
  <!-- Conteneur de pluie d'√©toiles -->
  <div id="star-rain"></div>

  <!-- Titre avec fond stylis√© -->
  <h1 class="title-bg text-2xl sm:text-3xl font-bold text-black mb-2 text-center relative z-10">
    ‚ú® Un petit bout de Martin ‚ú®
  </h1>

  <!-- Indicateur "Cerveau en fonctionnement" -->
  <div id="brain-indicator" class="flex items-center mb-4 bg-white bg-opacity-80 px-2 py-1 rounded relative z-10">
    <span class="w-3 h-3 bg-yellow-500 rounded-full animate-ping"></span>
    <span class="ml-2 text-sm text-gray-700">Cerveau en fonctionnement</span>
  </div>

  <!-- Bo√Æte pour le Message du jour -->
  <div id="daily-message" class="mb-4 text-center text-md bg-white bg-opacity-80 px-4 py-2 rounded shadow relative z-10">
    <strong>Message du jour</strong><br>
    Chargement du message quotidien...
  </div>

  <div class="flex flex-col items-center relative z-10 w-full max-w-md">
    <!-- Ic√¥ne de statut -->
    <div id="status-icon" class="text-3xl mb-2 animate-pulseSlow">üïí</div>

    <!-- Avatar avec explosion d'emoji au clic -->
    <div class="relative flex justify-center items-center w-32 h-32 sm:w-40 sm:h-40">
      <img id="avatar" src="{{ url_for('static', filename='images/avatar.png') }}"
           alt="Avatar de Martin"
           class="w-full h-full rounded-full border-4 border-pink-300 shadow-lg cursor-pointer animate-float animate-pulseSlow">
    </div>

    <!-- Statut -->
    <div id="status" class="text-base sm:text-lg font-semibold text-black mt-4 text-center">
      Chargement du statut...
    </div>

    <!-- Date et heure -->
    <div id="datetime" class="text-gray-500 text-sm mt-2 text-center"></div>

    <!-- Bo√Æte stylis√©e avec le message personnalis√© -->
    <div id="reason-box" class="title-bg text-black inline-block whitespace-nowrap mb-4 relative z-10">
      ‚ú® pourquoi ce connard ne r√©pond pas ‚ú®
    </div>

    <!-- Zone pour le message de r√©confort -->
    <div id="comfort-message" class="mt-4 bg-white bg-opacity-80 text-rose-600 px-4 py-2 rounded-2xl shadow-lg text-center w-full max-w-xs text-sm sm:text-base">
      Chargement du message...
    </div>

    <!-- Bouton interactif "Essaye moi" -->
    <button id="send-smile" class="mt-6 bg-rose-500 hover:bg-rose-600 text-white px-6 py-2 rounded-full shadow-md focus:outline-none">
      Essaye moi
    </button>

    <!-- Animation de c≈ìur pour "Essaye moi" -->
    <div id="heart-animation" class="mt-4 opacity-0">
      <span class="text-4xl">‚ù§Ô∏è</span>
    </div>

    <!-- Bo√Æte indice sous le c≈ìur -->
    <div id="hint-text" class="mt-2 text-sm text-gray-700 hidden relative z-10">
      psssst : clique sur ma t√™te pour voir
    </div>
  </div>

  <script>
    // R√©f√©rences aux √©l√©ments
    const statusDiv = document.getElementById('status');
    const statusIcon = document.getElementById('status-icon');
    const datetimeDiv = document.getElementById('datetime');
    const comfortMessageDiv = document.getElementById('comfort-message');
    const dailyMessageDiv = document.getElementById('daily-message');
    const sendSmileBtn = document.getElementById('send-smile');
    const heartAnimation = document.getElementById('heart-animation');
    const avatar = document.getElementById('avatar');
    const starRain = document.getElementById('star-rain');
    const hintText = document.getElementById('hint-text');

    const statusIcons = {
      "dort": "üí§", "r√©veille": "‚òï", "musique": "üé∂", "pause": "üçΩÔ∏è",
      "montage": "üé•", "code": "üíª", "√©crit": "‚úçÔ∏è", "d√©tend": "üåô", "default": "üïí"
    };

    const comfortMessages = [
      "Chaque jour, je pense √† toi. üíñ",
      "M√™me loin, mon c≈ìur bat pour toi. üíì",
      "Tu es mon rayon de soleil, m√™me √† distance. ‚òÄÔ∏è",
      "Rappelle-toi, je suis toujours l√†, peu importe l'heure. üåü",
      "Un petit sourire pour illuminer ta journ√©e. üòä"
    ];

    const dailyMessages = [
      "Aujourd'hui, n'oublie pas que tu es aim√©e. üå∏",
      "Un jour nouveau, une pens√©e pour toi. üåº",
      "Ta pr√©sence illumine ma journ√©e, m√™me √† distance. ‚ú®",
      "Chaque moment sans toi me rappelle combien tu comptes. üíï",
      "Reste forte, je suis toujours l√† pour toi. üåü"
    ];

    function setStatusIcon(statusText) {
      const keyword = Object.keys(statusIcons).find(word => statusText.includes(word));
      statusIcon.textContent = statusIcons[keyword] || statusIcons["default"];
    }

    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      datetimeDiv.textContent = `${now.toLocaleDateString('fr-FR', options)} - ${now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}`;
    }

    function fetchStatus() {
      fetch('/get_status')
        .then(response => response.json())
        .then(data => {
          statusDiv.textContent = data.status;
          setStatusIcon(data.status);
        });
    }

    function fetchComfortMessage() {
      fetch('/get_status_and_message')
        .then(response => response.json())
        .then(data => {
          comfortMessageDiv.textContent = data.message;
          comfortMessageDiv.classList.remove('animate-fadeOut');
          comfortMessageDiv.classList.add('animate-fadeIn');
          setTimeout(() => {
            comfortMessageDiv.classList.remove('animate-fadeIn');
            comfortMessageDiv.classList.add('animate-fadeOut');
          }, 15000);
        });
    }

    // Mise √† jour du message du jour (reste affich√©)
    function updateDailyMessage() {
      const index = new Date().getDate() % dailyMessages.length;
      dailyMessageDiv.innerHTML = `<strong>Message du jour</strong><br>${dailyMessages[index]}`;
      dailyMessageDiv.classList.remove('animate-fadeOut');
      dailyMessageDiv.classList.add('animate-fadeIn');
    }

    // Met √† jour le fond et g√®re la pluie d'√©toiles
    function updateBackground() {
      const now = new Date();
      const hour = now.getHours();
      const body = document.body;
      body.classList.remove('morning-bg', 'afternoon-bg', 'evening-bg', 'night-bg');
      if (hour >= 6 && hour < 12) {
        body.classList.add('morning-bg');
      } else if (hour >= 12 && hour < 18) {
        body.classList.add('afternoon-bg');
      } else if (hour >= 18 && hour < 21) {
        body.classList.add('evening-bg');
      } else {
        body.classList.add('night-bg');
      }
      updateStarRain(hour);
    }

    // Affiche la pluie d'√©toiles uniquement √† partir de 21h
    function updateStarRain(hour) {
      if (hour >= 21) {
        starRain.style.display = "block";
        startStarRain();
      } else {
        starRain.style.display = "none";
        anime.remove('.star');
      }
    }

    // G√©n√®re des √©toiles emoji "‚ú®" al√©atoires et les anime avec anime.js
    function startStarRain() {
      starRain.innerHTML = '';
      const starCount = 50;
      for (let i = 0; i < starCount; i++) {
        const starEl = document.createElement('span');
        starEl.classList.add('star');
        starEl.style.left = Math.random() * 100 + '%';
        starEl.style.fontSize = (Math.random() * 10 + 10) + 'px';
        starEl.innerText = '‚ú®';
        starRain.appendChild(starEl);
      }
      anime({
        targets: '.star',
        top: ['0%', '110%'],
        opacity: [0, 1, 0],
        duration: 1500,
        delay: anime.stagger(50, { start: 0 }),
        easing: 'linear',
        loop: true
      });
    }

    // Animation du c≈ìur sur le clic du bouton "Essaye moi"
    sendSmileBtn.addEventListener('click', () => {
      heartAnimation.classList.remove('opacity-0');
      heartAnimation.classList.add('animate-fadeIn');
      setTimeout(() => {
        heartAnimation.classList.remove('animate-fadeIn');
        heartAnimation.classList.add('animate-fadeOut');
        setTimeout(() => {
          heartAnimation.classList.remove('animate-fadeOut');
          heartAnimation.classList.add('opacity-0');
        }, 500);
      }, 2000);

      // Affiche le texte d'indice dans une bo√Æte sous le c≈ìur
      hintText.classList.remove('hidden');
      anime({
        targets: hintText,
        opacity: [0, 1],
        duration: 500,
        easing: 'linear'
      });
      setTimeout(() => {
        anime({
          targets: hintText,
          opacity: [1, 0],
          duration: 500,
          easing: 'linear',
          complete: function() {
            hintText.classList.add('hidden');
          }
        });
      }, 2500);
    });

    // Explosion d'emoji sur le clic de l'avatar avec anime.js
    avatar.addEventListener('click', () => {
      const rect = avatar.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const emojis = ["‚ù§Ô∏è", "‚ú®", "üòä", "üíñ", "üåü"];
      const count = 20;
      for (let i = 0; i < count; i++) {
        const emojiEl = document.createElement('span');
        emojiEl.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emojiEl.style.position = 'fixed';
        emojiEl.style.left = centerX + 'px';
        emojiEl.style.top = centerY + 'px';
        emojiEl.style.fontSize = '28px';
        emojiEl.style.opacity = 1;
        document.body.appendChild(emojiEl);
        anime({
          targets: emojiEl,
          translateX: () => anime.random(-200, 200),
          translateY: () => anime.random(-200, 200),
          scale: [1, anime.random(2, 3)],
          opacity: [1, 0],
          duration: 1200,
          easing: 'easeOutExpo',
          complete: function() {
            emojiEl.remove();
          }
        });
      }
    });

    window.onload = () => {
      updateDateTime();
      fetchStatus();
      fetchComfortMessage();
      updateDailyMessage();
      updateBackground();

      setInterval(updateDateTime, 1000);
      setInterval(fetchStatus, 20000);
      setInterval(fetchComfortMessage, 20000);
      setInterval(updateDailyMessage, 86400000);
      setInterval(updateBackground, 60000);
    };
  </script>
</body>
</html>
