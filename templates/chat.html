<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Petit bout de Martin ðŸ’–</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            animation: {
              float: "float 4s ease-in-out infinite",
              pulseSlow: "pulseSlow 3s ease-in-out infinite",
              fadeIn: "fadeIn 0.5s forwards",
              fadeOut: "fadeOut 0.5s forwards"
            },
            keyframes: {
              float: {
                "0%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-10px)" },
                "100%": { transform: "translateY(0)" },
              },
              pulseSlow: {
                "0%, 100%": { transform: "scale(1)" },
                "50%": { transform: "scale(1.15)" },
              },
              fadeIn: {
                from: { opacity: "0", transform: "translateY(-10px)" },
                to: { opacity: "1", transform: "translateY(0)" },
              },
              fadeOut: {
                from: { opacity: "1", transform: "translateY(0)" },
                to: { opacity: "0", transform: "translateY(-10px)" },
              },
            },
          },
        },
      };
    </script>
    <style>
        body {
            transition: background 1s ease, color 0.5s ease;
        }

        /* DÃ©gradÃ©s pour diffÃ©rentes heures */
        .morning-bg { background: linear-gradient(120deg, #FFDEE9, #B5FFFC); }
        .afternoon-bg { background: linear-gradient(120deg, #FBD786, #f7797d); }
        .evening-bg { background: linear-gradient(120deg, #a18cd1, #fbc2eb); }
        .night-bg {
            background: linear-gradient(120deg, #0f2027, #203a43, #2c5364);
            color: #d1d5db;
        }

        .night-bg::before {
            content: "";
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: url('https://cdn.pixabay.com/photo/2017/08/30/11/05/star-2694891_1280.png') repeat;
            background-size: 200px;
            animation: moveStars 50s linear infinite;
            opacity: 0.15;
            pointer-events: none;
        }

        @keyframes moveStars {
            from { background-position: 0 0; }
            to { background-position: 1000px 1000px; }
        }
    </style>
</head>
<body class="flex flex-col justify-center items-center min-h-screen relative overflow-hidden p-4">

<!-- ðŸŒ¸ Titre mignon -->
<h1 class="text-2xl sm:text-3xl font-bold text-black-500 mb-4 text-center">
    âœ¨ Un petit bout de Martin pour toi, Claire ðŸ’–
</h1>

<div class="flex flex-col items-center relative z-10 w-full max-w-md">
    <!-- IcÃ´ne de statut -->
    <div id="status-icon" class="text-3xl mb-2 animate-pulseSlow">ðŸ•’</div>

    <!-- Avatar flottant -->
    <div class="relative flex justify-center items-center w-32 h-32 sm:w-40 sm:h-40">
        <img id="avatar" src="{{ url_for('static', filename='images/avatar.png') }}"
             alt="Avatar de Martin"
             class="w-full h-full rounded-full border-4 border-pink-300 shadow-lg cursor-pointer animate-float animate-pulseSlow">
    </div>

    <!-- Statut textuel -->
    <div id="status" class="text-base sm:text-lg font-semibold text-gray-700 mt-4 text-center">
        Chargement du statut...
    </div>

    <!-- Date et heure -->
    <div id="datetime" class="text-gray-500 text-sm mt-2 text-center"></div>

    <!-- Bulle de message -->
    <div id="message-bubble"
         class="hidden bg-white text-rose-600 px-4 py-2 rounded-2xl shadow-lg text-center w-full max-w-xs mt-4 text-sm sm:text-base">
    </div>
</div>

<script>
    const body = document.body;
    const statusDiv = document.getElementById('status');
    const statusIcon = document.getElementById('status-icon');
    const bubble = document.getElementById('message-bubble');
    const datetimeDiv = document.getElementById('datetime');

    const statusIcons = {
        "dort": "ðŸ’¤", "rÃ©veille": "â˜•", "musique": "ðŸŽ¶", "pause": "ðŸ½ï¸",
        "montage": "ðŸŽ¥", "code": "ðŸ’»", "Ã©crit": "âœï¸", "dÃ©tend": "ðŸŒ™", "default": "ðŸ•’"
    };

    function setStatusIcon(statusText) {
        const keyword = Object.keys(statusIcons).find(word => statusText.includes(word));
        statusIcon.textContent = statusIcons[keyword] || statusIcons["default"];
    }

    function updateBackground() {
        const hour = new Date().getHours();
        body.classList.remove("morning-bg", "afternoon-bg", "evening-bg", "night-bg");

        if (hour >= 6 && hour < 12) body.classList.add("morning-bg");
        else if (hour >= 12 && hour < 18) body.classList.add("afternoon-bg");
        else if (hour >= 18 && hour < 21) body.classList.add("evening-bg");
        else body.classList.add("night-bg");
    }

    function updateDateTime() {
        const now = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = now.toLocaleDateString('fr-FR', options);
        const formattedTime = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        datetimeDiv.textContent = `${formattedDate} - ${formattedTime}`;
    }

    function fetchStatusAndMessage() {
        fetch('/get_status_and_message')
            .then(response => response.json())
            .then(data => {
                statusDiv.textContent = data.status;
                setStatusIcon(data.status);

                bubble.textContent = data.message;
                bubble.classList.remove('hidden', 'animate-fadeOut');
                bubble.classList.add('animate-fadeIn');

                setTimeout(() => {
                    bubble.classList.remove('animate-fadeIn');
                    bubble.classList.add('animate-fadeOut');
                }, 10000); // Affiche 10 secondes
            });
    }

    // Actualisations
    window.onload = () => {
        updateBackground();
        updateDateTime();
        fetchStatusAndMessage();
        setInterval(updateBackground, 60000);  // Fond toutes les minutes
        setInterval(updateDateTime, 1000);     // Heure chaque seconde
        setInterval(fetchStatusAndMessage, 20000);  // Messages toutes les 20 secondes
    };
</script>

</body>
</html>
